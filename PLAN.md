PLAN.md – Bootstrapping Leyline

A complete end-to-end playbook for standing up the Tenets + Bindings documentation system, wiring it into every codebase, and retiring legacy symlinks.

⸻

0 Meta

Item	Value
Repo Name	leyline (org-level, public-read, write-restricted)
Hierarchy	tenets/ (immutable truths) · bindings/ (enforceable rules)
Release scheme	SemVer tags (vMAJOR.MINOR.PATCH). MAJOR ↑ = breaking change to any Binding.
Sync model	Docs-Bot opens PRs after every tag; repos commit the vendor copy.
Cut-over deadline	T + 14 days from Day-0 (see timeline).



⸻

1 High-level timeline

Day	Milestone
0	Repo created, branch protection, CODEOWNERS
1	Tenets drafted, reviewed, merged
2	All legacy philosophy content decomposed into Bindings
3	v0.1.0 tag + CI (lint, schema check, site build) green
4	Docs-Bot workflow merged & tested against one pilot repo
5–9	Docs-Bot bulk PRs to all consumer projects; merge on green
10	Legacy symlinks removed; pre-commit hook forbids external syms
14	Static site (docs.leyline.local) live; go/no-go retrospective



⸻

2 Repo bootstrapping
	1.	Create repo phrazzld/leyline

gh repo create phrazzld/leyline --public --description "Tenets & Bindings for every Misty codebase"


	2.	Branch protection
	•	Default branch = master
	•	Require PR review (min 1) + status checks
	•	Enforce linear history
	3.	LICENSE – MIT
	4.	Directory scaffold

mkdir -p tenets bindings process tools .github/workflows
touch tenets/00-index.md bindings/00-index.md VERSION



⸻

3 File conventions

3.1 Front-matter schema

# front-matter keys (YAML, 3-hyphen fence)
id: ts-no-any           # unique slug
last_modified: 2025-05-05
derived_from: simplicity # Tenet id
enforced_by: eslint("no-explicit-any") & tsconfig("noImplicitAny")

3.2 Markdown headings
	•	# Tenet: <name> or # Binding: <name>
	•	First paragraph = ≤ 150 chars rationale.

3.3 Index files

00-index.md lists slugs + one-line summaries, auto-generated by tools/reindex.rb.

⸻

4 Populate content

4.1 Draft Tenets (immutable)

File	Title	Seed text
simplicity.md	Simplicity Above All	“Prefer the simplest design that works…”
no-secret-suppression.md	No Secret Suppressions	“No disabling lint/errors without public rationale…”
automation.md	Automation Is Mandatory	“Manual, repetitive steps are bugs in the process…”

4.2 Convert old documents → Bindings

Extract headings from existing philosophy docs; create one file per enforceable rule.

Example mapping:

Legacy source	New slug	Derived Tenet
DEVELOPMENT_PHILOSOPHY_TS.md / “No any”	ts-no-any.md	simplicity
Go appendix / error wrapping	go-error-wrapping.md	automation
Hexagon rule	hex-domain-purity.md	simplicity



⸻

5 CI & quality gate (.github/workflows/ci.yml)

name: ci
on: [push, pull_request]
jobs:
  lint-docs:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - run: pip install mdformat markdown-link-check
    - name: Format + link check
      run: |
        mdformat --check .
        markdown-link-check -q -c ./.mlc-config '**/*.md'
    - name: Schema validate
      run: ruby tools/validate_front_matter.rb
  build-site:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - run: |
        pip install mkdocs mkdocs-material
        mkdocs build --strict

	•	tools/validate_front_matter.rb asserts required keys + unique ids.

⸻

6 Docs-Bot (auto-vendor)

6.1 Reusable workflow in Leyline (.github/workflows/vendor.yml)

name: vendor-docs
on:
  workflow_call:
    inputs:
      ref:
        description: "Leyline tag"
        required: true
        type: string
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4   # consumer repo
    - name: Clone Leyline
      uses: actions/checkout@v4
      with:
        repository: phrazzld/leyline
        ref: ${{ inputs.ref }}
        path: _leyline
    - name: Rsync
      run: |
        rsync -a --delete _leyline/tenets docs/tenets
        rsync -a --delete _leyline/bindings docs/bindings
    - name: Commit
      run: |
        git config user.name  "Leyline-Bot"
        git config user.email "leyline-bot@users.noreply.github.com"
        git add docs/tenets docs/bindings || true
        if ! git diff --cached --quiet; then
          git commit -m "docs: sync Leyline ${{ inputs.ref }}"
        fi
    - name: Push PR
      uses: peter-evans/create-pull-request@v6
      with:
        title: "docs: sync Leyline ${{ inputs.ref }}"
        body: "Automated vendor update."

6.2 Release workflow (.github/workflows/release.yml)

On tag push → iterate over targets.txt (list of consuming repos) → dispatch workflow_run to call vendor.yml.

⸻

7 Consumer repo changes template
	1.	Delete symlinks
git rm docs/DEVELOPMENT_PHILOSOPHY*.md
	2.	Add GitHub workflow caller

# .github/workflows/vendor-docs.yml
name: Leyline Sync
on:
  pull_request:
  push:
jobs:
  docs:
    uses: phrazzld/leyline/.github/workflows/vendor.yml@v0.1.0
    with:
      ref: v0.1.0


	3.	Lefthook pre-commit (vendor-check):

vendor-check:
  run: diff -rq docs/tenets "$(git rev-parse --show-toplevel)/docs/tenets"


	4.	Add docs dir to .gitignore? – No. Commit the vendor files for offline view & blame history.

⸻

8 Governance

Action	Rule
Add / edit Tenet	PR label tenet; requires 2 Core Maintainers
Add / edit Binding	PR label binding; requires 1 Core Maintainer
Patch (typo) release	auto-merge on green
MAJOR bump	after Tenet/Biding change; release drafter posts changelog

CODEOWNERS file in Leyline assigns @core-maintainers to /tenets/ and /bindings/.

⸻

9 Static site (optional but recommended)
	•	mkdocs.yml root:

site_name: Leyline – Tenets & Bindings
nav:
  - Tenets: tenets/
  - Bindings: bindings/
theme: material


	•	Publish via GitHub Pages (gh-pages branch) in build-site job.

⸻

10 Risk & mitigation matrix

Risk	Mitigation
Bot PR storm overwhelms reviewers	Enable auto-merge when only vendor files change; label leyline-sync.
Consumer repo pins old tag	Renovate config: "packageRules": [{"matchPackageNames": ["phrazzld/leyline"], "enabled": true}]
Windows devs diff line endings	Add .gitattributes in Leyline: *.md text eol=lf
Docs drift (manual edit)	Pre-commit vendor-check + CI diff -rq ensure only bot updates vendor files.



⸻

11 Sunset checklist for symlink regime
	1.	Deprecate docs in old dotfiles repo:
	•	add DEPRECATED_SYMLINKS.md with pointer to Leyline.
	2.	Fail builds after T + 10 with custom linter rule no-external-symlink.
	3.	Clean history – prune orphan branches referencing the old symlinks.

⸻

12 Success criteria
	•	All active repos contain committed /docs/tenets & /docs/bindings at HEAD.
	•	CI green after Leyline bump with zero manual edits in consumers.
	•	Google Analytics (or GH traffic) shows > N monthly views on static site.
	•	New Binding added → bot PRs merged across fleet within 48 h.

